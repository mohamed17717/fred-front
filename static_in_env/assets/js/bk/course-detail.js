const bk="https://thegoodzone.pythonanywhere.com";function createElmV2(e){const t=document.createElement("div");return t.innerHTML=e.trim(),t.childNodes[0]}function handleCurriculumCollapse(){const e=document.querySelector(".block__curriculum"),t=e.querySelector(".block_curriculum_sections"),n=createElmV2('\n<button class="block__curriculum__view-all-lectures-btn" type="button">\n<span>Show All Lectures</span>\n<img alt="show all lectures icon" class="block__curriculum__view-all-lectures-btn-icon__svg"\n  src="https://fedora.teachablecdn.com/assets/icons/chevron-down-solid-263093b97bd01b06adb0ad6caee9cc0ed3fd93607596fb8dee102ebd20d6d85e.svg">\n</button>\n  ');console.log("sections: ",t),setTimeout(()=>{let e=t.querySelector("section").clientHeight;t.style.height=`${e}px`,t.style.overflow="hidden",t.dataset.collapsestatus=1},2e3),n.addEventListener("click",e=>{const n=t.dataset.collapsestatus;if(1==n)t.style.height="auto",t.dataset.collapsestatus=0;else if(0==n){let e=t.querySelector("section").clientHeight;t.style.height=`${e}px`,t.dataset.collapsestatus=1}}),e.appendChild(n)}function getCourseStars(e){let t="";for(let n=0;n<5;n++)t+=e>.44?'<div class="icon icon-star-fill"></div>':'<div class="icon icon-star-outline"></div>',e--;return t}function renderCourseIntroRating(e){document.querySelector("#course-intro .rating").innerHTML=`\n<div>${e.average}</div>\n<div class="stars">\n  ${getCourseStars(e.average)}\n</div>\n<div>\n  (${e.total} Ratings)\n</div>\n  `}function renderCourseFeedbackRatingTotal(e){document.querySelector("#course-feedback .rating .total").innerHTML=`\n<div class="num">${e.average}</div>\n<div class="stars">\n  ${getCourseStars(e.average)}\n</div>\n<div>\n  (${e.total} Ratings)\n</div>\n  `}function renderCourseFeedbackRatingProgress(e){document.querySelector("#course-feedback .rating .detail").innerHTML=`\n<ul>\n  <li>\n<div class="progress">\n<div class="fill" style="width: ${e.rates_counts[4]/e.total*100}%;"></div>\n</div>\n<div>(5/5) - ${(e.rates_counts[4]/e.total*100).toFixed(1)}%</div>\n  </li>\n  <li>\n<div class="progress">\n<div class="fill" style="width: ${e.rates_counts[3]/e.total*100}%;"></div>\n</div>\n<div>(4/5) - ${(e.rates_counts[3]/e.total*100).toFixed(1)}%</div>\n  </li>\n  <li>\n<div class="progress">\n<div class="fill" style="width: ${e.rates_counts[2]/e.total*100}%;"></div>\n</div>\n<div>(3/5) - ${(e.rates_counts[2]/e.total*100).toFixed(1)}%</div>\n  </li>\n  <li>\n<div class="progress">\n<div class="fill" style="width: ${e.rates_counts[1]/e.total*100}%;"></div>\n</div>\n<div>(2/5) - ${(e.rates_counts[1]/e.total*100).toFixed(1)}%</div>\n  </li>\n  <li>\n<div class="progress">\n<div class="fill" style="width: ${e.rates_counts[0]/e.total*100}%;"></div>\n</div>\n<div>(1/5) - ${(e.rates_counts[0]/e.total*100).toFixed(1)}%</div>\n  </li>\n</ul>\n  `}function insertReview(e){document.querySelector("#course-feedback .reviews .reviews-box").innerHTML+=`\n  <div class="review">\n<div class="author">\n<div class="avatar" style="background-image: url(${e.pp})"></div>\n\x3c!--\n<div class="bow">instructor</div>\n--\x3e\n</div>\n\n<div class="info">\n<div class="name">${e.name}</div>\n<div class="meta">\n  ${e.rating?`<div class="stars">\n${getCourseStars(e.rating.rate)}\n</div>`:""}\n  <div class="date">${e.created||"now"}</div>\n</div>\n<div class="opinion">\n  ${e.content}\n</div>\n</div>\n  </div>\n`}function renderReviews(e){e.forEach(e=>{insertReview(e)})}function setStarColor(e,t){e.style.filter=t}function setPrevStarsColor(e,t){for(;e;)setStarColor(e,t),e=e.previousElementSibling}const postData=async(e,t)=>{return await fetch(e,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(t)})};function renderFeedbackRate(){const e=currentUser.email?currentUser:anonUser;console.log("user: ",e);const t=document.querySelector("[data-courseid]").dataset.courseid,n=e.email||"16",s=document.querySelectorAll(".rating .rate .stars .icon"),r="invert(45%) sepia(32%) saturate(2410%) hue-rotate(347deg) brightness(99%) contrast(93%)";fetch(`${bk}/rate/${t}/${n}`).then(e=>200===e.status?e.json():null).then(e=>{if(e){setPrevStarsColor(document.querySelector(`#course-feedback .rate .stars .icon:nth-child(${e.rate})`),r)}else s.forEach(e=>{e.addEventListener("mouseover",t=>setPrevStarsColor(e,r)),e.addEventListener("mouseout",t=>setPrevStarsColor(e,"invert(0%) sepia(38%) saturate(7%) hue-rotate(119deg) brightness(90%) contrast(53%)")),e.addEventListener("click",e=>setCourseRate(e,n,t))})})}function setCourseRate(e,t,n){const s=document.querySelectorAll(".rating .rate .stars .icon"),r=e.target;postData(`${bk}/rate/${n}/`,{userId:t,rate:r.dataset.ratevalue}).then(e=>e.status).then(e=>{200===e&&(setPrevStarsColor(r,"invert(45%) sepia(32%) saturate(2410%) hue-rotate(347deg) brightness(99%) contrast(93%)"),s.forEach(e=>{const t=e.cloneNode(!0);e.parentNode.replaceChild(t,e)}))})}function notifyText(e,t,n){const s=n||e.innerText;e.innerText=t,e.disabled=!0,setTimeout(()=>{e.innerText=s,e.disabled=!1},2e3)}function setReview(){const e=currentUser.email?currentUser:anonUser;console.log("user: ",e);const t=document.querySelector("[data-courseid]").dataset.courseid,n=e.email||"16",s=document.querySelector("#course-feedback .reviews .write");s.innerHTML=`\n<div class="author">\n  <div class="avatar" style="background-image: url(${e.pp})"></div>\n  \x3c!--\n  <div class="bow">instructor</div>\n  --\x3e\n</div>\n\n<div class="info">\n  <div class="name">${e.name}</div>\n  <div>\n<textarea name="review" id="review" placeholder="Leave a review..."></textarea>\n  </div>\n  <div class="bottom">\n<button class="solid">post comment</button>\n  </div>\n</div>\n  `,s.querySelector("button").addEventListener("click",r=>{notifyText(r.target,"loading...");const a={userId:n,rate:r.target.dataset.ratevalue,...e,content:s.querySelector("textarea").value};postData(`${bk}/review/${t}/`,a).then(e=>e.status).then(e=>{200===e?(notifyText(r.target,"success!","post comment"),s.querySelector("textarea").value="",insertReview(a)):notifyText(r.target,"failed!","post comment")})})}function renderInstructor(){}function getRecommendedCourses(){const e=document.querySelector("[data-courseid]");if(!e)return;const t=e.dataset.courseid,n=document.querySelector("#course-suggest-courses"),s=n.querySelector(".courses");fetch(`${bk}/random-related-courses/${t}/`).then(e=>200===e.status?e.json():[]).then(e=>{e.forEach(e=>{s.innerHTML+=`\n<div class="item card">\n<div class="thumbnail" style="background-image: url(${e.thumbnail})"></div>\n\n<div class="info">\n  <h3><a href="${e.url}">${e.title}</a></h3>\n\n\n  <div class="rating">\n<div>${e.rating.average}</div>\n<div class="stars">\n${getCourseStars(e.rating.average)}\n</div>\n<div>\n(${e.rating.total} Ratings)\n</div>\n  </div>\n\n  <p>\n${e.description}\n  </p>\n  <div class="footer">\n<div class="author">\n<div class="avatar" style="background-image: url(${e.author_pp})"></div>\n<div class="name">${e.author_name}</div>\n</div>\n<div class="price">${e.price}</div>\n  </div>\n</div>\n</div>\n  `}),0===e.length&&n.remove()})}function renderCourseFeedbacks(){const e=document.querySelector("[data-courseid]").dataset.courseid,t=`${bk}/course/${e}`;console.log(t),fetch(t).then(e=>e.json()).then(e=>{console.log(e),renderCourseIntroRating(e.rating),renderReviews(e.reviews),renderCourseFeedbackRatingTotal(e.rating),renderCourseFeedbackRatingProgress(e.rating)})}function getCurrentUserData(){const e=document.querySelector("meta#fedora-data").dataset;let t={};return e&&(t={img:e.gravatarUrl,pp:e.gravatarUrl,email:e.email,name:e.name}),t}const anonUser={name:"anonymous",email:"anon@anon.com",pp:"https://iptc.org/wp-content/uploads/2018/05/avatar-anonymous-300x300.png"};let currentUser=null;document.addEventListener("DOMContentLoaded",e=>{currentUser=getCurrentUserData(),console.log("currentUser: ",currentUser),handleCurriculumCollapse(),renderCourseFeedbacks(),renderFeedbackRate(),setReview(),getRecommendedCourses()});